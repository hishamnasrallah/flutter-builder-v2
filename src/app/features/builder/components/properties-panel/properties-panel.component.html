
    <div class="properties-panel">
      <div class="panel-header">
        <h3 class="text-sm font-semibold text-gray-700">Properties</h3>
        @if (selectedWidget) {
          <button
            class="text-xs text-blue-600 hover:text-blue-700"
            (click)="resetAllProperties()"
            title="Reset all properties to default">
            Reset All
          </button>
        }
      </div>

      <div class="panel-content">
        @if (selectedWidget) {
          <!-- Widget Info -->
          <div class="widget-info-card">
            <div class="widget-type-badge">
              <span class="widget-icon">{{ getWidgetIcon() }}</span>
              <span class="widget-type">{{ selectedWidget.type }}</span>
            </div>
            <div class="widget-id">
              <span class="text-xs text-gray-400">ID:</span>
              <span class="text-xs text-gray-600 font-mono">{{ selectedWidget.id.substring(0, 8) }}...</span>
            </div>
          </div>

          <!-- Property Categories -->
          @for (category of propertyCategories; track category.name) {
            <div class="property-category">
              <button
                class="category-header"
                (click)="toggleCategory(category)"
                [class.expanded]="category.expanded">
                <svg
                  class="w-3 h-3 transition-transform"
                  [class.rotate-90]="category.expanded"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                <span class="category-icon">{{ category.icon }}</span>
                <span class="category-name">{{ category.name }}</span>
                <span class="category-count">{{ category.properties.length }}</span>
              </button>

              @if (category.expanded) {
                <div class="category-properties">
                  @for (property of category.properties; track property.key) {
                    @if (shouldShowProperty(property)) {
                      <div class="property-item">
                        <div class="property-header">
                          <label class="property-label">{{ property.label }}</label>
                        @if (hasCustomValue(property)) {
                          <button
                            class="reset-btn"
                            (click)="resetProperty(property.key)"
                            title="Reset to default">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                              </path>
                            </svg>
                          </button>
                        }
                      </div>
                        </div>
                    }

                      <!-- Property Editor based on type -->
                      @switch (property.type) {
                        @case ('text') {
                          <app-text-input
                            [value]="getPropertyValue(property.key)"
                            [placeholder]="property.label"
                            (valueChange)="onPropertyChange(property.key, $event)">
                          </app-text-input>
                        }
                        @case ('number') {
                          <app-number-input
                            [value]="getPropertyValue(property.key)"
                            [min]="property.min"
                            [max]="property.max"
                            [step]="property.step || 1"
                            [unit]="property.unit"
                            (valueChange)="onPropertyChange(property.key, $event)">
                          </app-number-input>
                        }
                        @case ('color') {
                          <app-color-picker
                            [value]="getPropertyValue(property.key)"
                            (valueChange)="onPropertyChange(property.key, $event)">
                          </app-color-picker>
                        }
                        @case ('select') {
                          <app-select-dropdown
                            [value]="getPropertyValue(property.key)"
                            [options]="property.options || []"
                            (valueChange)="onPropertyChange(property.key, $event)">
                          </app-select-dropdown>
                        }
                        @case ('spacing') {
                          <app-spacing-editor
                            [value]="getPropertyValue(property.key)"
                            (valueChange)="onPropertyChange(property.key, $event)">
                          </app-spacing-editor>
                        }
                        @case ('alignment') {
                          <app-alignment-picker
                            [value]="getPropertyValue(property.key)"
                            (valueChange)="onPropertyChange(property.key, $event)">
                          </app-alignment-picker>
                        }
                        @case ('boolean') {
                          <app-toggle-switch
                            [value]="getPropertyValue(property.key)"
                            (valueChange)="onPropertyChange(property.key, $event)">
                          </app-toggle-switch>
                        }
                      }

                      @if (getValidationError(property)) {
                        <div class="error-message">
                          {{ getValidationError(property) }}
                        </div>
                      }


                  }


                </div>

              }

            </div>
          }

        } @else {
          <!-- No Selection State -->
          <div class="no-selection">
            <svg class="w-16 h-16 text-gray-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4">
              </path>
            </svg>
            <p class="text-sm text-gray-500 mt-4">Select a widget to edit properties</p>
            <p class="text-xs text-gray-400 mt-1">Click any widget on the canvas</p>
          </div>
        }
      </div>
    </div>
